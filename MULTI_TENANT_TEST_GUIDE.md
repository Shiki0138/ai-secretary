# マルチテナント AI秘書システム テストガイド

## 🎯 実装完了内容

1. **マルチテナント対応** ✅
   - テナントIDベースの完全なデータ分離
   - 企業ごとの独立したデータ空間
   - 招待コードによる従業員追加機能

2. **カレンダー連携** ✅
   - スケジュール管理API実装
   - 空き時間検索機能
   - イベント作成・更新・キャンセル機能

3. **タスク管理** ✅
   - タスク作成・更新・コメント機能
   - 優先度別管理（urgent/high/normal/low）
   - リマインダー設定機能
   - 期限管理と期限切れタスク通知

## 📱 LINEでのテスト手順

### 1. 経営者（あなた）の再登録

LINEで以下のメッセージを送信してください：

```
田中です。合同会社Leadfiveの経営者をしています。
```

システムからの返信例：
```
田中様、はじめまして。

AI秘書システムへようこそ。
合同会社Leadfiveの経営者として登録完了しました。

テナントID: tenant_leadfive_xxxxxxxx

従業員を招待する場合は、以下の招待コードをお伝えください：
招待コード: XXXXXXXX

どのようなご用件でしょうか？
```

### 2. システムとの対話テスト

#### A. スケジュール確認
```
明日の予定を教えて
```

#### B. タスク確認
```
今週のタスクを確認したい
```

#### C. 従業員からの報告受信テスト
従業員役として別のLINEアカウントから送信するか、以下のような指示を出してください：
```
営業部の山田から売上報告が来たと仮定して、緊急度の高い内容として通知してください
```

### 3. 従業員の登録（別アカウントでテスト）

別のLINEアカウントがある場合、以下の手順で従業員として登録：

1. 招待コードを送信：
```
招待コード: XXXXXXXX
```

2. システムからの返信後、名前と部署を送信：
```
山田太郎です。営業部です。
```

### 4. 従業員からの報告テスト

従業員アカウントから以下のようなメッセージを送信：

```
今月の売上が目標を20%超過しました。詳細レポートを作成しましたので、ご確認をお願いします。
```

経営者アカウントに以下のような通知が届きます：
```
📋 重要報告

報告者: 山田太郎（営業部）

【要約】
今月売上が目標20%超過、レポート確認依頼

【詳細】
今月の売上が目標を20%超過しました。詳細レポートを作成しましたので、ご確認をお願いします。

【推奨アクション】
レポートの確認と今後の戦略検討
```

## 🔧 Vercelデプロイ確認

以下のコマンドでデプロイ状況を確認：

```bash
vercel list
```

本番環境のURLでAPIが動作していることを確認：
```bash
curl https://ai-secretary-ten.vercel.app/api/tenant-setup
```

## 📊 データ構造

### テナント分離の仕組み

すべてのデータキーにテナントIDが含まれるため、他社のデータにはアクセスできません：

```
tenant:{tenantId}:info                 → テナント情報
tenant:{tenantId}:user:{userId}        → ユーザー情報
tenant:{tenantId}:executives           → 経営者リスト
tenant:{tenantId}:employees            → 従業員リスト
tenant:{tenantId}:calendar:*           → カレンダーデータ
tenant:{tenantId}:task:*               → タスクデータ
```

## ⚠️ 注意事項

1. **環境変数の確認**
   - `UPSTASH_REDIS_REST_URL`
   - `UPSTASH_REDIS_REST_TOKEN`
   - `OPENAI_API_KEY`
   - `LINE_CHANNEL_ACCESS_TOKEN`
   - `LINE_CHANNEL_SECRET`
   
2. **LINE Webhook URLの更新**
   LINE Developers Consoleで以下のURLに設定されていることを確認：
   ```
   https://ai-secretary-ten.vercel.app/api/webhook
   ```

3. **テストデータのクリーンアップ**
   必要に応じて、Upstash Redisコンソールから古いデータを削除できます。

## 🎉 次のステップ

1. **従業員の追加**
   - 招待コードを使って実際の従業員を登録
   - 部署別の管理体制構築

2. **カスタマイズ**
   - 営業時間の設定（現在は9:00-18:00）
   - 通知設定のカスタマイズ
   - レポートフォーマットの調整

3. **他社への展開**
   - 新しい企業の経営者が登録すると自動的に新テナント作成
   - 各企業は完全に独立した環境で運用可能

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. Vercelのログ: `vercel logs`
2. Upstash Redisのデータ確認
3. LINE Developers Consoleのエラーログ

マルチテナントAI秘書システムの準備が整いました！🚀